(function(A){A.fn.highchartTable=function(){var D=["column","line","area","spline","pie"];var E=function(K,J){var L=A(K).data(J);if(typeof L!="undefined"){var H=L.split(".");var F=window[H[0]];for(var G=1,I=H.length;G<I;G++){F=F[H[G]]}return F}};this.each(function(){var X=A(this);var w=A(X);var t=1;var P=A("caption",X);var r=P.length?A(P[0]).text():"";var p;if(w.data("graph-container-before")!=1){var u=w.data("graph-container");if(!u){throw"graph-container data attribute is mandatory"}if(u[0]==="#"||u.indexOf("..")===-1){p=A(u)}else{var Z=X;var T=u;while(T.indexOf("..")!==-1){T=T.replace(/^.. /,"");Z=Z.parent()}p=A(T,Z)}if(p.length!==1){throw"graph-container is not available in this DOM or available multiple times"}p=p[0]}else{w.before("<div></div>");p=w.prev();p=p[0]}var k=w.data("graph-type");if(!k){throw"graph-type data attribute is mandatory"}if(A.inArray(k,D)==-1){throw"graph-container data attribute must be one of "+D.join(", ")}var G=w.data("graph-stacking");if(!G){G="normal"}var N=w.data("graph-datalabels-enabled");var o=w.data("graph-inverted")==1;var Y=A("thead th",X);var R=[];var a=[];var g=0;var f=false;Y.each(function(AD,x){var AG=A(x);var z=AG.data("graph-value-scale");var AC=AG.data("graph-type");if(A.inArray(AC,D)==-1){AC=k}var i=AG.data("graph-stack-group");if(i){f=true}var AA=AG.data("graph-datalabels-enabled");if(typeof AA=="undefined"){AA=N}var AB=AG.data("graph-yaxis");if(typeof AB!="undefined"&&AB=="1"){t=2}var AF=AG.data("graph-skip")==1;if(AF){g=g+1}var y={libelle:AG.text(),skip:AF,indexTd:AD-g-1,color:AG.data("graph-color"),visible:!AG.data("graph-hidden"),yAxis:typeof AB!="undefined"?AB:0,dashStyle:AG.data("graph-dash-style")||"solid",dataLabelsEnabled:AA==1,dataLabelsColor:AG.data("graph-datalabels-color")||w.data("graph-datalabels-color")};var AE=AG.data("graph-vline-x");if(typeof AE=="undefined"){y.scale=typeof z!="undefined"?parseFloat(z):1;y.graphType=AC=="column"&&o?"bar":AC;y.stack=i;y.unit=AG.data("graph-unit");R[AD]=y}else{y.x=AE;y.height=AG.data("graph-vline-height");y.name=AG.data("graph-vline-name");a[AD]=y}});var O=[];A(R).each(function(x,y){if(x!=0&&!y.skip){var z={name:y.libelle+(y.unit?" ("+y.unit+")":""),data:[],type:y.graphType,stack:y.stack,color:y.color,visible:y.visible,yAxis:y.yAxis,dashStyle:y.dashStyle,marker:{enabled:false},dataLabels:{enabled:y.dataLabelsEnabled,color:y.dataLabelsColor,align:w.data("graph-datalabels-align")||(k=="column"&&o==1?undefined:"center")}};if(y.dataLabelsEnabled){var i=E(X,"graph-datalabels-formatter");if(i){z.dataLabels.formatter=function(){return i(this.y)}}}O.push(z)}});A(a).each(function(i,x){if(typeof x!="undefined"&&!x.skip){O.push({name:x.libelle,data:[{x:x.x,y:0,name:x.name},{x:x.x,y:x.height,name:x.name}],type:"spline",color:x.color,visible:x.visible,marker:{enabled:false}})}});var h=[];var H=E(X,"graph-point-callback");var n=w.data("graph-xaxis-type")=="datetime";var s=A("tbody:first tr",X);s.each(function(x,y){if(!!A(y).data("graph-skip")){return}var i=A("td",y);i.each(function(z,AE){var AL;var AF=R[z];if(AF.skip){return}var AA=A(AE);if(z==0){AL=AA.text();h.push(AL)}else{var AJ=AA.text();var AH=O[AF.indexTd];if(AJ.length==0){if(!n){AH.data.push(null)}}else{var AB=AJ.replace(/\s/g,"").replace(/,/,".");AL=Math.round(parseFloat(AB)*AF.scale*100)/100;var AK=AA.data("graph-x");if(n){AK=A("td",A(y)).first().text();var AD=C(AK);AK=AD.getTime()-AD.getTimezoneOffset()*60*1000}var AG=AA.data("graph-name");var AC={name:typeof AG!="undefined"?AG:AJ,y:AL,x:AK};if(H){AC.events={click:function(){return H(this)}}}if(AF.graphType==="pie"){if(AA.data("graph-item-highlight")){AC.sliced=1}}var AI=AA.data("graph-item-color");if(typeof AI!="undefined"){AC.color=AI}AH.data.push(AC)}}})});var M=[];var d;for(d=1;d<=t;d++){var K={title:{text:typeof w.data("graph-yaxis-"+d+"-title-text")!="undefined"?w.data("graph-yaxis-"+d+"-title-text"):null},max:typeof w.data("graph-yaxis-"+d+"-max")!="undefined"?w.data("graph-yaxis-"+d+"-max"):null,min:typeof w.data("graph-yaxis-"+d+"-min")!="undefined"?w.data("graph-yaxis-"+d+"-min"):null,reversed:w.data("graph-yaxis-"+d+"-reversed")=="1",opposite:w.data("graph-yaxis-"+d+"-opposite")=="1",tickInterval:w.data("graph-yaxis-"+d+"-tick-interval")||null,labels:{rotation:w.data("graph-yaxis-"+d+"-rotation")||0},startOnTick:w.data("graph-yaxis-"+d+"-start-on-tick")!=="0",endOnTick:w.data("graph-yaxis-"+d+"-end-on-tick")!=="0",stackLabels:{enabled:w.data("graph-yaxis-"+d+"-stacklabels-enabled")=="1"},gridLineInterpolation:w.data("graph-yaxis-"+d+"-grid-line-interpolation")||null};var m=E(X,"graph-yaxis-"+d+"-formatter-callback");if(m){K.labels.formatter=function(){return m(this.value)}}M.push(K)}var J=["#4572A7","#AA4643","#89A54E","#80699B","#3D96AE","#DB843D","#92A8CD","#A47D7C","#B5CA92"];var l=[];var V=typeof Highcharts.theme!="undefined"&&typeof Highcharts.theme.colors!="undefined"?Highcharts.theme.colors:[];var L=w.data("graph-line-shadow");var W=w.data("graph-line-width")||2;var S=Math.max(J.length,V.length);for(var q=0;q<S;q++){var e="graph-color-"+(q+1);l.push(typeof w.data(e)!="undefined"?w.data(e):typeof V[q]!="undefined"?V[q]:J[q])}var j=w.data("graph-margin-top");var v=w.data("graph-margin-right");var b=w.data("graph-margin-bottom");var Q=w.data("graph-margin-left");var c=w.data("graph-xaxis-labels-enabled");var I={};var U=w.data("graph-xaxis-labels-font-size");if(typeof U!="undefined"){I.fontSize=U}var F={colors:l,chart:{renderTo:p,inverted:o,marginTop:typeof j!="undefined"?j:null,marginRight:typeof v!="undefined"?v:null,marginBottom:typeof b!="undefined"?b:null,marginLeft:typeof Q!="undefined"?Q:null,spacingTop:w.data("graph-spacing-top")||10,height:w.data("graph-height")||null,zoomType:w.data("graph-zoom-type")||null,polar:w.data("graph-polar")||null},title:{text:r},subtitle:{text:w.data("graph-subtitle-text")||""},legend:{enabled:w.data("graph-legend-disabled")!="1",layout:w.data("graph-legend-layout")||"horizontal",symbolWidth:w.data("graph-legend-width")||30,x:w.data("graph-legend-x")||15,y:w.data("graph-legend-y")||0},xAxis:{categories:(w.data("graph-xaxis-type")!="datetime")?h:undefined,type:(w.data("graph-xaxis-type")=="datetime")?"datetime":undefined,reversed:w.data("graph-xaxis-reversed")=="1",opposite:w.data("graph-xaxis-opposite")=="1",showLastLabel:typeof w.data("graph-xaxis-show-last-label")!="undefined"?w.data("graph-xaxis-show-last-label"):true,tickInterval:w.data("graph-xaxis-tick-interval")||null,dateTimeLabelFormats:{second:"%e. %b",minute:"%e. %b",hour:"%e. %b",day:"%e. %b",week:"%e. %b",month:"%e. %b",year:"%e. %b"},labels:{rotation:w.data("graph-xaxis-rotation")||0,align:w.data("graph-xaxis-align")||"center",enabled:typeof c!="undefined"?c:true,style:I},startOnTick:w.data("graph-xaxis-start-on-tick"),endOnTick:w.data("graph-xaxis-end-on-tick"),min:B(X,"min"),max:B(X,"max"),alternateGridColor:w.data("graph-xaxis-alternateGridColor")||null,title:{text:w.data("graph-xaxis-title-text")||null},gridLineWidth:w.data("graph-xaxis-gridLine-width")||0,gridLineDashStyle:w.data("graph-xaxis-gridLine-style")||"ShortDot",tickmarkPlacement:w.data("graph-xaxis-tickmark-placement")||"between",lineWidth:w.data("graph-xaxis-line-width")||0},yAxis:M,tooltip:{formatter:function(){if(w.data("graph-xaxis-type")=="datetime"){return"<b>"+this.series.name+"</b><br/>"+Highcharts.dateFormat("%e. %b",this.x)+" : "+this.y}else{var i=typeof h[this.point.x]!="undefined"?h[this.point.x]:this.point.x;if(k==="pie"){return"<strong>"+this.series.name+"</strong><br />"+i+" : "+this.point.y}return"<strong>"+this.series.name+"</strong><br />"+i+" : "+this.point.name}}},credits:{enabled:false},plotOptions:{line:{dataLabels:{enabled:true},lineWidth:W},area:{lineWidth:W,shadow:typeof L!="undefined"?L:true,fillOpacity:w.data("graph-area-fillOpacity")||0.75},pie:{allowPointSelect:true,dataLabels:{enabled:true},showInLegend:w.data("graph-pie-show-in-legend")=="1",size:"80%"},series:{animation:false,stickyTracking:false,stacking:f?G:null,groupPadding:w.data("graph-group-padding")||0}},series:O,exporting:{filename:r.replace(/ /g,"_"),buttons:{exportButton:{menuItems:null,onclick:function(){this.exportChart()}}}}};w.trigger("highchartTable.beforeRender",F);new Highcharts.Chart(F)});return this};var B=function(F,D){var G=A(F).data("graph-xaxis-"+D);if(typeof G!="undefined"){if(A(F).data("graph-xaxis-type")=="datetime"){var E=C(G);return E.getTime()-E.getTimezoneOffset()*60*1000}return G}return null};var C=function(I){var F=I.split(" ");var H=F[0].split("-");var G=null;var E=null;if(F[1]){var D=F[1].split(":");G=parseInt(D[0],10);E=parseInt(D[1],10)}return new Date(parseInt(H[0],10),parseInt(H[1],10)-1,parseInt(H[2],10),G,E)}})(jQuery);